<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<title>A SWI-Prolog to Dotnet interface</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:24.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:18.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p
	{margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
address
	{mso-style-link:"HTML Address Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	font-style:italic;}
code
	{font-family:"Courier New";}
pre
	{mso-style-link:"HTML Preformatted Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";}
tt
	{font-family:"Courier New";}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Constantia","serif";
	color:#7C9163;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Constantia","serif";
	color:#A5B592;
	font-weight:bold;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-link:"HTML Preformatted";
	font-family:Consolas;}
span.HTMLAddressChar
	{mso-style-name:"HTML Address Char";
	mso-style-link:"HTML Address";
	font-family:"Times New Roman","serif";
	font-style:italic;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
.MsoChpDefault
	{font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

<meta name=Author content="Douglas R. Miles">
</head>

<body lang=EN-US link=blue vlink=purple>

<div class=WordSection1>

<h1><i>SWICLI 1.x</i> Prolog API overview</h1>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<span style='font-size:12.0pt;font-family:"Times New Roman","serif"'>

<ul type=disc>
 <li class=MsoNormal><a href="#Introduction">Introduction</a></li>
 <li class=MsoNormal><a href="#JPL_types_Dotnet_types_as_seen_by">SWICLI types (.NET
     types, as seen by Prolog)</a></li>
 <li class=MsoNormal><a href="#representation_of_Dotnet_values...">representation
     of .NET values and references within Prolog</a></li>
 <li class=MsoNormal><a href="#repn_of_Dotnet_types_1_structured">representation
     of .NET types within Prolog (1): <i>structured</i> notation</a></li>
 <li class=MsoNormal><a href="#repn_of_Dotnet_types_2_descriptor">representation
     of .NET types within Prolog (2): <i>descriptor</i> notation</a></li>
 <li class=MsoNormal><a href="#repn_of_Dotnet_types_3_classname">representation
     of .NET types within Prolog (3): classname notation</a></li>
 <li class=MsoNormal><a href="#creating_instances_of_Dotnet_classes">creating
     instances of .NET classes</a></li>
 <li class=MsoNormal><a href="#calling_methods_of_Dotnet_objects_...">calling
     methods of .NET objects or classes</a></li>
 <li class=MsoNormal><a href="#fetching_field_values_of_Dotnet_objects..">fetching
     field values of .NET objects or classes</a></li>
 <li class=MsoNormal><a href="#setting_field_values_of_Dotnet_objects...">setting
     field values of .NET objects or classes</a></li>
 <li class=MsoNormal><a href="#a_slightly_longer_example">a slightly longer
     example</a></li>
 <li class=MsoNormal><a href="#jpl_new3">cli_new/3</a></li>
 <li class=MsoNormal><a href="#jpl_call4">cli_call/4</a></li>
 <li class=MsoNormal><a href="#jpl_set3">cli_set/3</a></li>
 <li class=MsoNormal><a href="#jpl_get3">cli_get/3</a></li>
 <li class=MsoNormal><a href="#exceptions">exceptions thrown by .NET</a></li>
 <li class=MsoNormal><a href="#testing">testing</a></li>
 <li class=MsoNormal><a href="#to_do">to do</a></li>
</ul>

</span>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name=Introduction></a><span style='font-family:"Arial","sans-serif"'>Introduction</span></h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>This is an
overview of an interface which allows SWI-Prolog programs to dynamically create
and manipulate .NET objects.</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>Here are some significant
features of the interface and its implementation:</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>it is
     completely dynamic: no precompilation is required to manipulate any .NET
     classes which can be found at run time, and any objects which can be
     instantiated from them</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>it is
     interoperable with <b><i>SWICLI</i></b>'s .NET API (which has evolved from
     Uwe Lesta's <i>SwiPlCS</i>)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>it requires
     .NET 2.0 and class libraries (although it doesn't depend on any .NET
     2-specific facilities, and originally was developed for use with both 1.0
     thru 4.0 .NETs, I haven't tested it with 1.0 recently, and don't support
     this)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>it exploits
     the <i>Invocation API</i> of the <i>.NET P/Invoke Interface</i>: this is a
     mandatory feature of any compliant .NET</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>it is
     implemented with a fair amount of C# code and Prolog code in one module (<i>swicli.pl</i>)&nbsp;
     (which I believe to be ISO Standard Prolog compliant and portable) and a
     SWI-Prolog-specific foreign library (<i>swicli[32].dll</i> for Windows and
     swicli[32].so *nix), implemented in ANSI C but making a lot of use of the
     SWI-Prolog <i>Foreign Language Interface </i>Then uses Swicli.Library.dll
     (Managed binary) that runs on both Mono and .NET runtimes.</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>the
     foreign-language part has so far been tested on Windows XP, Windows7 and
     Fedora Linux, but is believed to be readily portable to SWI-Prolog on
     other platforms</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>as far as
     is feasible, .NET data values and object references are represented within
     Prolog canonically and without loss of information (minor exceptions: .NET
     <i>float </i>and <i>double</i> values are both converted to Prolog <i>float
     </i>values; .NET <i>byte</i>, <i>char</i>, <i>short</i>, <i>int</i> and <i>long</i>
     values are all converted to Prolog <i>integer</i> values; the type
     distinctions which are lost are normally of no significance)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>references
     within Prolog to .NET objects:</span></li>
 <ul type=circle>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>should be
      treated as opaque handles</span></li>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>are canonical
      (two references are ==/2 equal if-and-only-if they refer to the <i>same
      object</i> within the .NET)</span></li>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>are
      represented as structures containing a distinctive atom so as to exploit
      SWI-Prolog's atom garbage collection: when an object reference is
      garbage-collected in Prolog, the .NET garbage collector is informed, so
      there is sound and complete overall garbage collection of .NET objects
      within the combined Prolog+.NET system</span></li>
 </ul>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>.NET class
     methods can be called by name: <b><i>SWICLI</i></b> invisibly fetches (and
     caches) essential details of method invocation, exploiting <i>.NET
     Reflection</i> facilities</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>the API is
     similar to that of XPCE: the four main interface calls are <i>cli_new</i>,
     <i>cli_call, cli_set</i> and <i>cli_get</i> (there is a single <i>cli_free</i>,
     though .NET's garbage collection is extended transparently into Prolog)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><i><span style='font-family:"Arial","sans-serif"'>cli_call</span></i><span
     style='font-family:"Arial","sans-serif"'> resolves overloaded methods
     automatically and dynamically, inferring the types of the call's actual
     parameters, and identifying the most specific of the applicable method
     implementations (similarly, <i>cli_new</i> resolves overloaded
     constructors)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Prolog code
     which uses the API calls is responsible for passing suitably-typed values
     and references, since the P/INVOKE doesn't perform complete dynamic
     type-checking, and nor currently does <b><i>SWICLI</i></b> (although the <i>overloaded
     method resolution</i> mechanism could probably be adapted to do this)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Prolog code
     can reason about the types of .NET data values, object references, fields
     and methods: <b><i>SWICLI</i></b> supports a canonical representation of
     all .NET types as structured terms (e.g. </span><tt><b><span
     style='font-size:10.0pt'>array(array(byte))</span></b></tt><span
     style='font-family:"Arial","sans-serif"'>) and also as atomic .NET
     signatures</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>the
     Prolog-calls-.NET (mine) and .NET-calls-Prolog (Fred's) parts of <b><i>SWICLI</i></b>
     are largely independent; mine concentrates on representing all .NET data
     values and objects within Prolog, and supporting manipulation of objects;
     Fred's concentrates on representing any Prolog term within .NET, and
     supporting the calling of goals within Prolog and the retrieving of
     results back into .NET</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Helvetica","sans-serif"'>when
     called from Prolog, <i>void</i> methods return a <i>void</i> value (which
     is distinct from all other <b><i>SWICLI</i></b> values and references)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>it uses </span><tt><b><span
     style='font-size:13.5pt'>@/1</span></b></tt><span style='font-family:"Arial","sans-serif"'>
     to construct representations of certain .NET values; if&nbsp; </span><tt><b><span
     style='font-size:13.5pt'>@/1</span></b></tt><span style='font-family:"Arial","sans-serif"'>
     is defined as a prefix operator (as used by XPCE), then you can write </span><tt><b><span
     style='font-size:13.5pt'>@false</span></b></tt><span style='font-family:
     "Arial","sans-serif"'>, </span><tt><b><span style='font-size:13.5pt'>@true</span></b></tt><span
     style='font-family:"Arial","sans-serif"'>, </span><tt><b><span
     style='font-size:13.5pt'>@null</span></b></tt><span style='font-family:
     "Arial","sans-serif"'> etc. in your source code; otherwise (and for
     portability) you'll have to write e.g. </span><tt><b><span
     style='font-size:13.5pt'>@(true)</span></b></tt><span style='font-family:
     "Arial","sans-serif"'> etc.</span></li>
</ul>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="JPL_types_Dotnet_types_as_seen_by"></a>SWICLI types (.NET types, as
seen by Prolog)</h2>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>All .NET
values and object references which are passed between Prolog engines and .NET
VMs via <b><i>SWICLI</i></b>'s Prolog API are seen as instances of types within
this simplified <b><i>SWICLI</i></b> type system:<br>
<br>
a <b><i>datum</i></b>&nbsp;&nbsp; (this term is introduced, out of necessity,
to refer jointly to <i>values </i>and <i>refs</i>)</span> </p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>is a <b><i>value</i></b>&nbsp;&nbsp;&nbsp;
(values are copied between Prolog and the .NET)</span></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>is a <b><i>boolean</i></b></span></p>

</blockquote>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>char</i></b></span></p>

</blockquote>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>long</i></b>,
<b><i>int</i></b>, <b><i>short</i></b> or <b><i>byte</i></b></span></p>

</blockquote>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>double</i></b>
or <b><i>float</i></b></span></p>

</blockquote>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>string</i></b>&nbsp;&nbsp;
(an instance of <i>System.String</i>)</span></p>

</blockquote>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>void</i></b>&nbsp;&nbsp;&nbsp;&nbsp;
(an artificial value returned by calls to .NET void methods)</span></p>

</blockquote>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>ref</i></b></span>
</p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>is <b><i>null</i></b></span></p>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or an <b><i>object</i></b>&nbsp;&nbsp;&nbsp;
(held within the .NET, and represented in Prolog by a canonical reference)</span>
</p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>is an <b><i>array</i></b></span></p>

</blockquote>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a <b><i>class
instance</i></b> (other than of <i>System.String</i>)</span></p>

</blockquote>

</blockquote>

</blockquote>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="representation_of_Dotnet_values..."></a>representation of .NET
values and references within Prolog</h2>

<p class=MsoNormal><span style='font-family:"Helvetica","sans-serif"'>Instances
of <b><i>SWICLI</i></b> types are represented within Prolog as follows:</span></p>

<p class=MsoNormal><b><i><span style='font-family:"Arial","sans-serif"'>boolean</span></i></b><span
style='font-family:"Arial","sans-serif"'> has two values, represented by </span><tt><b><span
style='font-size:13.5pt'>@(true)</span></b></tt><span style='font-family:"Arial","sans-serif"'>
and </span><tt><b><span style='font-size:13.5pt'>@(false)</span></b></tt> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>char</span></i></b><span
style='font-family:"Arial","sans-serif"'> values are represented by corresponding
Prolog <i>integers</i></span> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>int</span></i></b><span
style='font-family:"Arial","sans-serif"'>, <b><i>short</i></b> and <b><i>byte</i></b>
values are represented by corresponding Prolog <i>integers</i></span> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>long</span></i></b><span
style='font-family:"Arial","sans-serif"'> values are represented as Prolog <i>integers</i>
if possible (32-bit in current SWI-Prolog), else as </span><tt><b><span
style='font-size:13.5pt'>jlong(Hi,Lo)</span></b></tt><span style='font-family:
"Arial","sans-serif"'> where </span><tt><b><span style='font-size:13.5pt'>Hi</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is an <i>integer</i> corresponding to
the top32 bits of the long, and </span><tt><b><span style='font-size:13.5pt'>Lo</span></b></tt><span
style='font-family:"Arial","sans-serif"'> similarly represents the lower 32
bits</span> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>double</span></i></b><span
style='font-family:"Arial","sans-serif"'> and <b><i>float</i></b> values are
represented as Prolog floats (which are equivalent to .NET doubles) (there may
be minor rounding, normalisation or loss-of-precision issues when a .NET float
is widened to a Prolog float then narrowed back again, but what the heck)</span>
</p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>string</span></i></b><span
style='font-family:"Arial","sans-serif"'> values (immutable instances of <i>System.Stri</i>ng)
are represented as Prolog <i>atoms</i> (in UTF-8 encoding)</span> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>null</span></i></b><span
style='font-family:"Arial","sans-serif"'> has only one value, represented as </span><tt><b><span
style='font-size:13.5pt'>@(null)</span></b></tt> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>void</span></i></b><span
style='font-family:"Arial","sans-serif"'> has only one value, represented as </span><tt><b><span
style='font-size:13.5pt'>@(void)</span></b></tt> </p>

<p><b><i><span style='font-family:"Arial","sans-serif"'>array</span></i></b><span
style='font-family:"Arial","sans-serif"'> and <b><i>class instance</i></b>
references are currently represented as </span><tt><b><span style='font-size:
13.5pt'>@(Tag)</span></b></tt><span style='font-family:"Arial","sans-serif"'>,
where Tag ia an <i>atom</i> whose name encodes a P/INVOKE global reference
value; this may change, but won't affect Prolog programs which respect the
opacity of references</span></p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="repn_of_Dotnet_types_1_structured"></a>Representation of .NET types
within Prolog (1): <i>structured</i> notation</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>The <b><i>SWICLI
Prolog API</i></b> allows Prolog applications to inspect, manipulate, and
reason about the types of .NET values, references, methods etc., and this
section describes how these types themselves (as opposed to instances thereof)
are represented.&nbsp; Predicates which pass these type representations include
</span><b><a href="api.html#jpl_class_to_type/2">cli_class_to_type/2</a>, <a
href="api.html#jpl_classname_to_type/2">cli_classname_to_type/2</a>, <a
href="api.html#jpl_datum_to_type/2">cli_datum_to_type/2</a>, <a
href="api.html#jpl_is_object_type/1">cli_is_object_type/1</a>, <a
href="api.html#jpl_is_type/1">cli_is_type/1</a>, </b><a
href="api.html#jpl_object_to_type/2"><b>cli_object_to_type/2</b></a><b>, <a
href="api.html#jpl_primitive_type/1">cli_primitive_type/1</a>, <a
href="api.html#jpl_ref_to_type/2">cli_ref_to_type/2</a>, <a
href="api.html#jpl_type_to_class/2">cli_type_to_class/2</a>. <a
href="api.html#jpl_type_to_classname/2">cli_type_to_classname/2</a>.</b> </p>

<p class=MsoNormal><b><i><span style='font-family:"Arial","sans-serif"'>void</span></i></b><span
style='font-family:"Arial","sans-serif"'> is represented as </span><tt><b><span
style='font-size:13.5pt'>void</span></b></tt></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><b><i><span style='font-family:"Arial","sans-serif"'>null</span></i></b><span
style='font-family:"Arial","sans-serif"'> is represented as </span><tt><b><span
style='font-size:13.5pt'>null</span></b></tt></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>the primitive
types are represented as </span><tt><b><span style='font-size:13.5pt'>boolean</span></b></tt><span
style='font-family:"Arial","sans-serif"'>, </span><tt><b><span
style='font-size:13.5pt'>char</span></b></tt><span style='font-family:"Arial","sans-serif"'>,
</span><tt><b><span style='font-size:13.5pt'>byte</span></b></tt><span
style='font-family:"Arial","sans-serif"'>, </span><tt><b><span
style='font-size:13.5pt'>short</span></b></tt><span style='font-family:"Arial","sans-serif"'>,
</span><tt><b><span style='font-size:13.5pt'>int</span></b></tt><span
style='font-family:"Arial","sans-serif"'>, </span><tt><b><span
style='font-size:13.5pt'>long</span></b></tt><span style='font-family:"Arial","sans-serif"'>,
</span><tt><b><span style='font-size:13.5pt'>float</span></b></tt><span
style='font-family:"Arial","sans-serif"'>, </span><tt><b><span
style='font-size:13.5pt'>double</span></b></tt></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><b><i><span style='font-family:"Arial","sans-serif"'>classes</span></i></b><span
style='font-family:"Arial","sans-serif"'> are represented as </span><tt><b><span
style='font-size:13.5pt'>class(</span></b></tt><i><span style='font-family:
"Arial","sans-serif"'>package_parts</span></i><tt><b><span style='font-size:
13.5pt'>,</span></b></tt><i><span style='font-family:"Arial","sans-serif"'>classname_parts</span></i><tt><b><span
style='font-size:13.5pt'>)</span></b></tt> </p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>e.g.&nbsp; </span><tt><b><span
style='font-size:13.5pt'>class(['System','Forms'],['TextBox'])</span></b></tt></p>

<p class=MsoNormal><b><i><span style='font-family:"Arial","sans-serif"'>array</span></i></b><span
style='font-family:"Arial","sans-serif"'> types are represented as </span><tt><b><span
style='font-size:13.5pt'>array(</span></b></tt><i><span style='font-family:
"Arial","sans-serif"'>type</span></i><tt><b><span style='font-size:13.5pt'>)</span></b></tt>
</p>

<p class=MsoNormal>e.g.&nbsp; <tt><b><span style='font-size:13.5pt'>array(boolean)</span></b></tt></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal>e.g.&nbsp; <tt><b><span style='font-size:13.5pt'>array(class([System],['String'])</span></b></tt></p>

</blockquote>

</blockquote>

<p class=MsoNormal><span style='font-family:"Helvetica","sans-serif"'>This <i>structured
</i>notation for .NET types is designed to be convenient for composition and
decomposition by matching (unification).</span></p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="repn_of_Dotnet_types_2_descriptor"></a>representation of .NET types
within Prolog (2): <i>descriptor</i> notation</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>The <i>descriptor</i>
notation for .NET types is one of two textual notations employed by the .NET
and the .NET class libraries; <b><i>SWICLI</i></b> (necessarily) supports both
(and supports conversion between all three representations).</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>Examples:</span> </p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>'bool'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>boolean</i></b></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'byte(4)'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>System.Byte</i></b></span>
</p>

<p><tt><b><span style='font-size:13.5pt'>'char'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>System.Character</i></b></span></p>

<p><tt><b><span style='font-size:13.5pt'>'short'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>short</i></b></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'int'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>int32</i></b></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'long'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>long</i></b></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'single'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>float</i></b></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'double'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes <b><i>double</i></b></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'L.NET/util/Date;'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> (for example) deno</span><span
style='font-family:"Helvetica","sans-serif"'>tes the .NET</span><span
style='font-family:"Arial","sans-serif"'> clas</span><span style='font-family:
"Helvetica","sans-serif"'>s <i>.NET.util.Date</i></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'</span></b></tt><i><span
style='font-family:"Arial","sans-serif"'>type[]</span></i><tt><b><span
style='font-size:13.5pt'>'</span></b></tt><span style='font-family:"Arial","sans-serif"'>
denotes an <b><i>array</i></b> of <i>type</i></span> </p>

<p><tt><b><span style='font-size:13.5pt'>'(</span></b></tt><i><span
style='font-family:"Arial","sans-serif"'>argument_types</span></i><tt><b><span
style='font-size:13.5pt'>)</span></b></tt><i><span style='font-family:"Arial","sans-serif"'>return_type</span></i><tt><b><span
style='font-size:13.5pt'>'</span></b></tt><span style='font-family:"Arial","sans-serif"'>
denotes the type of a method</span></p>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="repn_of_Dotnet_types_3_classname"></a>representation of .NET types
within Prolog (3): <i>classname</i> notation</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>The <i>classname</i>
notation for .NET types is the other textual notation employed by the .NET and
the .NET class libraries.&nbsp; It is a (seemingly unnecessary) variation on
the <i>descriptor</i> notation, used by a few P/INVOKE routines.&nbsp; It has
the slight advantage that, in the case of simple class types only, it resembles
the .NET source text notation for classes.&nbsp; This representation is
supported only because certain P/INVOKE functions use it; it is used within <b><i>SWICLI</i></b>'s
implementation of <b>cli_call/4</b> etc.&nbsp; You may encounter this notation
when tracing <b><i>SWICLI</i></b> activity, but otherwise you need not know
about it.</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>Examples:</span> </p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>'System.Array'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes the .NET class </span><tt><span
style='font-size:13.5pt'>System.Array</span></tt></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>'array(bool)'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes an <b><i>array</i></b> of <b><i>boolean</i></b></span></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>'[LSystem.String;'</span></b></tt><span
style='font-family:"Arial","sans-serif"'> denotes an <b><i>array</i></b> of <b><i>string</i></b></span></p>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h1>Using the <i>SWICLI 1.x</i> Prolog API</h1>

<h2><a name="creating_instances_of_Dotnet_classes"></a>creating instances of .NET
classes</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>To create an
instance of a .NET class from within Prolog, call <b>cli_new(+Class,+Params,-Ref)</b>
with a classname, a list of actual parameters for the constructor, and a
variable to be bound to the new reference, e.g.</span> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_new( 'System.Forms.Frame',
['frame with dialog'], F)</span></b></tt></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>which binds <b>F</b>
to a new object reference, e.g.</span> </p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>&nbsp;</span><tt><b><span
style='font-size:13.5pt'>@('C#0008272420')</span></b></tt></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>(not that the
details of this structure are of any necessary concern to the Prolog programmer
or to the applications she writes).<br>
NB for convenience, this predicate is overloaded: <b>Class</b> can also be a
class type in <i>structured </i>notation, e.g. </span><code><span
style='font-size:10.0pt'>array(boolean)</span></code><span style='font-family:
"Arial","sans-serif"'>.</span></p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="calling_methods_of_Dotnet_objects_..."></a>calling methods of .NET
objects or classes</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>The object
reference generated by the <b>cli_new/3</b> call (above) can be passed to other
<b><i>SWICLI</i></b> API predicates such as </span></p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_call( +Ref,
+Method, +Params, -Result)</span></b></tt></p>

<p class=MsoNormal>&nbsp;<span style='font-family:"Arial","sans-serif"'>e.g.</span>
</p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_call( F,
setVisible, [@(true)], _)</span></b></tt></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>which calls
the <b>setVisible</b> method of the object to which <b>F</b> refers,
effectively passing it the .NET value <i>true.</i></span> </p>

<p><span style='font-family:"Arial","sans-serif"'>(This call should display the
new <b>JFrame</b> in the top left corner of the desktop.)</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>Note the anonymous variable
passed as the fourth argument to <b>cli_call/4.&nbsp;</b> A variable in this
position receives the result of the method call: either a value or a reference.&nbsp;
Since </span><tt><b><span style='font-size:13.5pt'>SetVisible()</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is a void method, the call returns
the (artificial) reference </span><tt><b><span style='font-size:13.5pt'>@(void)</span></b></tt><span
style='font-family:"Arial","sans-serif"'>.</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>Some may prefer to code this
call thus:</span> </p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_call( F,
setVisible, [@true], @void)</span></b></tt></p>

</blockquote>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>which
documents the programmer's understanding that this is a <i>void </i>method (and
fails if it isn't :-).<br>
</span>&nbsp;<br>
<span style='font-family:"Arial","sans-serif"'>If the </span><b><span
style='font-family:"Helvetica","sans-serif"'>+Ref</span></b><span
style='font-family:"Arial","sans-serif"'> argument represents a class, then the
named static method of that class&nbsp; is called.</span> </p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="fetching_field_values_of_Dotnet_objects..."></a>Fetching field and
property values of .NET objects or classes</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>The <b>cli_get/3</b>
API predicate can retrieve the value of an instance field or a static field,
e.g.</span> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_get( 'System.Color',
pink, Pink)</span></b></tt></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>which binds
the Prolog variable </span><tt><b><span style='font-size:13.5pt'>Pink</span></b></tt><span
style='font-family:"Arial","sans-serif"'> to a reference to the predefined <b>dotnet.awt.Color</b>
&quot;constant&quot; which is held in the static final <b>.pink</b> field of
the <b>.NET.awt.Color</b> class.</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>More generally, <b>cli_get/3</b>
has the following interface:</span> </p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_get(
+Class_or_Object, +Field, -Datum)</span></b></tt></p>

</blockquote>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>If the first
argument represents a class, then a static field of that class with FieldName
is accessed.</span> </p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="setting_field_values_of_Dotnet_objects..."></a>Setting field or
properties values of .NET objects or classes</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Object and
class fields can be set (i.e. have values or references assigned to them) by
the <b>cli_set/3</b> API procedure, which has the following interface:</span> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_set(
+Class_or_Object, +Field, +Datum)</span></b></tt></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>where <b>Datum</b>
must be a value or reference of a type suitable for assignment to the named
field of the class or object.</span> </p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="a_slightly_longer_example"></a>a slightly longer example</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>This code
fragment</span> </p>

<pre><tt><b><span style='font-size:13.5pt'>&nbsp;&nbsp;&nbsp; findall(</span></b></tt><b><span
style='font-size:13.5pt'><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ar,</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (&nbsp;&nbsp; current_prolog_flag( N, V),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; term_to_atom( V, Va),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cli_new( '[LSystem.String;', [N,Va], Ar)</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),</tt><br>
<tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Ars</tt><br>
<tt>&nbsp;&nbsp;&nbsp; ),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_new( '[[LSystem.String;', Ars, Ac),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_datums_to_array( [name,value], Ah),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_new( 'System.Forms.Frame', ['current_prolog_flag'], F),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_call( F, getContentPane, [], CP),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_new( 'System.Forms.Table', [Ac,Ah], T),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_new( 'System.Forms.ScrollPane', [T], SP),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_call( CP, add, [SP,'Center'], _),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_call( F, setSize, [600,400], _),</tt></span></b></pre>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>builds an
array of arrays of strings containing the names and values of the current
SWI-Prolog &quot;flags&quot;, and displays it in a JTable within a ScrollPane
within a JFrame:</span> </p>

<p class=MsoNormal><img border=0 width=524 height=269 src=screendump.jpg></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>In addition
to <b><i>SWICLI</i></b> API calls, this code calls <b>cli_datums_to_array/2</b>,
a utility which converts any list of valid representations of .NET values (or
objects) into a new .NET array, whose base type is the most specialised type of
which all list members are instances, and which is defined thus:</span> </p>

<pre><tt><b><span style='font-size:13.5pt'>cli_datums_to_array( Ds, A) :-</span></b></tt><b><span
style='font-size:13.5pt'><br>
<tt>&nbsp;&nbsp;&nbsp; ground( Ds),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_datums_to_most_specific_common_ancestor_type( Ds, T),</tt><br>
<tt>&nbsp;&nbsp;&nbsp; cli_new( array(T), Ds, A).</tt></span></b></pre>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Having found
the &quot;most specific common ancestor type&quot; (my phrase :-), a new array
of this type is created, whose elements are initialised to the successive
members of the list of datums.</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>This illustrates another mode
of operation of <b>cli_new/3</b>:</span> </p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_new( +ArrayType,
+InitialValues, -ArrayRef)</span></b></tt></p>

</blockquote>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>See the
relevant Appendix for fuller details of the API procedures.</span> </p>

<p><span style='font-family:"Arial","sans-serif"'>Don't forget the possibility
of writing and manipulating new .NET classes to serve your Prolog applications:
this interface is not designed to make .NET programming redundant :-)</span> </p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<p class=MsoNormal><br>
<a name="jpl_new3"></a><tt><b><span style='font-size:18.0pt'>cli_new( +X,
+Argz, -V) :-</span></b></tt> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>X</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be:</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a suitable <i>type</i></span></li>
 <ul type=circle>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>i.e. any </span><tt><b><span
      style='font-size:13.5pt'>class(_,_)</span></b></tt><span
      style='font-family:"Arial","sans-serif"'>, </span><tt><b><span
      style='font-size:13.5pt'>array(_)</span></b></tt><span style='font-family:
      "Arial","sans-serif"'> or primitive type (e.g. </span><tt><b><span
      style='font-size:13.5pt'>byte</span></b></tt><span style='font-family:
      "Arial","sans-serif"'> but not </span><tt><b><span style='font-size:13.5pt'>void</span></b></tt><span
      style='font-family:"Arial","sans-serif"'>)</span></li>
 </ul>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an atomic <i>classname</i></span></li>
 <ul type=circle>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>e.g. </span><tt><b><span
      style='font-size:13.5pt'>'System.String'</span></b></tt></li>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>e.g. </span><tt><b><span
      style='font-size:13.5pt'>'LSystem.String;'</span></b></tt><span
      style='font-family:"Arial","sans-serif"'>&nbsp;&nbsp; (a redundant but
      legitimate form)</span></li>
 </ul>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an atomic <i>descriptor</i></span></li>
 <ul type=circle>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>e.g. </span><tt><b><span
      style='font-size:13.5pt'>'[I'</span></b></tt></li>
 </ul>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a class
     object</span></li>
 <ul type=circle>
  <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>i.e. an
      object whose type is&nbsp; </span><tt><b><span style='font-size:13.5pt'>class([.NET,lang],['Class'])</span></b></tt></li>
 </ul>
</ul>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>if </span><tt><b><span
style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
denotes a primitive type and </span><tt><b><span style='font-size:13.5pt'>Argz</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is castable to a value of that type,
then </span><tt><b><span style='font-size:13.5pt'>V</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is that value (a pointless mode of
operation, but somehow complete...)</span></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>if </span><tt><b><span
style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
denotes an array type and </span><tt><b><span style='font-size:13.5pt'>Argz</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is a non-negative integer, then </span><tt><b><span
style='font-size:13.5pt'>V</span></b></tt><span style='font-family:"Arial","sans-serif"'>
is a new array of that many elements, initialised to the appropriate default
value</span></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>if </span><tt><b><span
style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
denotes an array type and </span><tt><b><span style='font-size:13.5pt'>Argz</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is a list of datums, each of which is
(independently) castable to the array element type, then </span><tt><b><span
style='font-size:13.5pt'>V</span></b></tt><span style='font-family:"Arial","sans-serif"'>
is a new array of as many elements as </span><tt><b><span style='font-size:
13.5pt'>Argz</span></b></tt><span style='font-family:"Arial","sans-serif"'> has
members, initialised to the results of casting the respective members of </span><tt><b><span
style='font-size:13.5pt'>Argz</span></b></tt></p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>if </span><tt><b><span
style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
denotes a non-array object type and </span><tt><b><span style='font-size:13.5pt'>Argz</span></b></tt><span
style='font-family:"Arial","sans-serif"'> is a list of datums, then </span><tt><b><span
style='font-size:13.5pt'>V</span></b></tt><span style='font-family:"Arial","sans-serif"'>
is the result of an invocation of that type's most specifically-typed
constructor to whose respective parameters the members of </span><tt><b><span
style='font-size:13.5pt'>Argz</span></b></tt><span style='font-family:"Arial","sans-serif"'>
are assignable</span></p>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<p class=MsoNormal><br>
<a name="jpl_call4"></a><tt><b><span style='font-size:18.0pt'>cli_call( +X,
+Method, +Args, -R) :-</span></b></tt> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>X</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be:</span> </p>

<p class=MsoNormal><span style='font-family:Symbol'>·</span>  <span
style='font-family:"Arial","sans-serif"'>a <i>type</i>, <i>class object</i> or <i>classname</i>
(for static methods of the denoted class, or for static or instance methods of System.Class)</span>
</p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:Symbol'>·</span>  <span
style='font-family:"Arial","sans-serif"'>a class instance or array (for static
or instance methods)</span> </p>

</blockquote>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>Method</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be:</span> </p>

<p class=MsoNormal><span style='font-family:Symbol'>·</span>  <span
style='font-family:"Arial","sans-serif"'>an atomic method name (if this name is
ambiguous, as a result of method overloading, then it will be resolved by
considering the types of <b>Args</b>, as far as they can be inferred)</span> </p>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:Symbol'>·</span>  <span
style='font-family:"Arial","sans-serif"'>an integral method index (untested:
for static overload resolution)</span> </p>

</blockquote>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-family:Symbol'>·</span>  <span
style='font-family:"Arial","sans-serif"'>a </span><tt><b><span
style='font-size:13.5pt'>methodID/1</span></b></tt><span style='font-family:
"Arial","sans-serif"'> structure (ditto)</span> </p>

</blockquote>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>Args</span></b></tt><span
style='font-family:"Arial","sans-serif"'> must be</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a proper
     list (possibly empty) of ground arguments</span></li>
</ul>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Finally, an
attempt will be made to unify </span><tt><b><span style='font-size:13.5pt'>R</span></b></tt><span
style='font-family:"Arial","sans-serif"'> with the returned result.</span></p>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<p class=MsoNormal><br>
<a name="jpl_set3"></a><tt><b><span style='font-size:18.0pt'>cli_set( +X,
+Field, +V) :-</span></b></tt> </p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>basically,
sets the </span><tt><b><span style='font-size:13.5pt'>Fspec</span></b></tt><span
style='font-family:"Arial","sans-serif"'>-th field of object </span><tt><b><span
style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
to value </span><tt><b><span style='font-size:13.5pt'>V</span></b></tt> </p>

<p><tt><b><span style='font-size:13.5pt'>X</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be:</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a <i>class
     object</i>, a <i>classname</i>, or an (object or array) <i>type</i> (for
     static fields, or System.Class fields)</span></li>
</ul>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a <i>class
     instance</i> (for non-static fields)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an <i>array</i>
     (for indexed element or subrange assignment)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>but not a <i>string</i>
     (no fields to retrieve)</span></li>
</ul>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>Field</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be:</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an atomic
     field name (overloading will be resolved dynamically, by considering the
     inferred type of </span><b><span style='font-family:"Helvetica","sans-serif"'>V</span></b><span
     style='font-family:"Arial","sans-serif"'>)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an integral
     field index (static resolution: not tried yet)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a </span><tt><b><span
     style='font-size:13.5pt'>fieldID/1</span></b></tt><span style='font-family:
     "Arial","sans-serif"'> (static resolution: not tried yet)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a variable
     (field names, or array indices, are generated)(?!)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an array
     index </span><tt><b><span style='font-size:13.5pt'>I</span></b></tt><span
     style='font-family:"Arial","sans-serif"'> (</span><tt><b><span
     style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
     must be an array object: </span><tt><b><span style='font-size:13.5pt'>X[I]</span></b></tt><span
     style='font-family:"Arial","sans-serif"'> is assigned </span><tt><b><span
     style='font-size:13.5pt'>V</span></b></tt><span style='font-family:"Arial","sans-serif"'>)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a pair </span><tt><b><span
     style='font-size:13.5pt'>I-J</span></b></tt><span style='font-family:"Arial","sans-serif"'>
     of integers (</span><tt><b><span style='font-size:13.5pt'>J</span></b></tt><span
     style='font-family:"Arial","sans-serif"'> can be a variable) (</span><tt><b><span
     style='font-size:13.5pt'>X</span></b></tt><span style='font-family:"Arial","sans-serif"'>
     must be an array object, </span><tt><b><span style='font-size:13.5pt'>V</span></b></tt><span
     style='font-family:"Arial","sans-serif"'> must be a list of values: </span><tt><b><span
     style='font-size:13.5pt'>X[I-J]</span></b></tt><span style='font-family:
     "Arial","sans-serif"'> will be assigned </span><tt><b><span
     style='font-size:13.5pt'>V</span></b></tt><span style='font-family:"Arial","sans-serif"'>)</span></li>
</ul>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>V</span></b></tt><span
style='font-family:"Arial","sans-serif"'> must be ground (although one day we
may pass variables to <b><i>SWICLI</i></b>?!)</span></p>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<p class=MsoNormal><br>
<a name="jpl_get3"></a><tt><b><span style='font-size:18.0pt'>cli_get( +X,
+Field, -V) :-</span></b></tt> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>X</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be:</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a <i>class
     object</i>, a <i>classname</i>, or an (object or array) <i>type</i> (for
     static fields, or System.Class fields)</span></li>
</ul>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>a <i>class
     instance</i> (for non-static fields)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an <i>array</i>
     (for the 'length' pseudo field, or for indexed element retrieval)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>but not a String
     (clashes with classname; anyway, System.String has no fields to retrieve)</span></li>
</ul>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>Field</span></b></tt><span
style='font-family:"Arial","sans-serif"'> can be</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>an atomic
     field name</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or an
     integral field index (these are a secret :-)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a </span><tt><b><span
     style='font-size:13.5pt'>fieldID/1</span></b></tt><span style='font-family:
     "Arial","sans-serif"'> (not for general consumption :-)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or an
     integral array index (high-bound checking is done by .NET, maybe throwing
     an exception)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a
     variable (field names, or array indices, are generated)</span></li>
</ul>

</blockquote>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>or a pair </span><tt><b><span
     style='font-size:13.5pt'>I-J</span></b></tt><span style='font-family:"Arial","sans-serif"'>
     of integers or variables (array subranges are generated) (relational or
     what?!)</span></li>
</ul>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Immediately
before <b>cli_get/4</b> returns, an attempt will be made to unify </span><tt><b><span
style='font-size:13.5pt'>V</span></b></tt><span style='font-family:"Arial","sans-serif"'>
with the internally computed result.</span></p>

</blockquote>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name=exceptions></a>exceptions thrown by .NET</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Uncaught
exceptions thrown by the .NET in the course of handling a <b><i>SWICLI</i> 3.x
Prolog API</b> call are mapped onto Standard Prolog exceptions, e.g.</span> </p>

<pre><tt><b><span style='font-size:13.5pt'>cli_new( 'Systen.DateTime', [yesterday], D)</span></b></tt></pre>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>raises the
Prolog exception</span> </p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_exception('System.IllegalArgumentException',
@'C#0008408972')</span></b></tt></p>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>because, as
the exception suggests, <b>yesterday </b>is not a valid constructor argument.</span><br>
&nbsp;<br>
<span style='font-family:"Helvetica","sans-serif"'>.NET exceptions are always
returned as Prolog exceptions with this structure:</span></p>

<p class=MsoNormal><tt><b><span style='font-size:13.5pt'>cli_exception( <i>classname</i>,
<i>reference_to_exception_object</i>)</span></b></tt></p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name=testing></a>testing</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>For a
rudimentary test, run</span> </p>

<pre><tt><b><span style='font-size:13.5pt'>?- cli_demo.</span></b></tt></pre>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>and wait
patiently for some Swing windows to appear (but not too patiently, in case
something is wrong...)</span> </p>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<h2><a name="to_do"></a>to do</h2>

<p class=MsoNormal><span style='font-family:"Arial","sans-serif"'>Apart from
any bugs I don't know about, this interface is usable and useful as it
stands.&nbsp; Nevertheless there are some things &quot;to do&quot; at some
stage in the future, e.g.</span> </p>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>support
     non-virtual method calls (i.e. explicitly call a method of some ancestor
     class despite there being an overriding method (i.e. of the same name
     etc.) in a &quot;nearer&quot; class). &nbsp;I believe this is a fairly
     arcane .NET feature, but it is needed for completeness; I want to
     accommodate it without complicating the syntax of regular method calls.</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>map the .NET's
     </span><tt><b><span style='font-size:13.5pt'>vprintf()</span></b></tt><span
     style='font-family:"Arial","sans-serif"'> messages onto something in
     SWI-Prolog (the user_error stream?)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>catch the .NET's
     </span><tt><b><span style='font-size:13.5pt'>abort()</span></b></tt><span
     style='font-family:"Arial","sans-serif"'> and </span><tt><b><span
     style='font-size:13.5pt'>exit()</span></b></tt><span style='font-family:
     "Arial","sans-serif"'> events, and handle them appropriately (e.g. stop a .NET
     <i>abort</i> from killing the SWI-Prolog process)</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>propagate
     SWI-Prolog's ABORT action into the .NET as appropriate, e.g. to interrupt
     a pending <b><i>SWICLI</i></b> call</span></li>
</ul>

<ul type=disc>
 <li class=MsoNormal><span style='font-family:"Arial","sans-serif"'>reduce the
     (extravagant) overheads of each <b><i>SWICLI</i></b> call (without
     compromising functionality or safety)</span></li>
</ul>

<div class=MsoNormal align=center style='text-align:center'>

<hr size=2 width="100%" align=center>

</div>

<address><span style='font-size:13.5pt'><a
href="mailto:paul.singleton@bcs.org.uk">Douglas R. Miles</a></span></address>

<address><span style='font-size:13.5pt'>drafted 10th November 2000</span></address>

<address><span style='font-size:13.5pt'>revised 14th December 2000</span></address>

<address style='margin-bottom:12.0pt'><span style='font-size:13.5pt'>revised
11th March 2003<br>
revised 18th February 2004</span></address>

<p class=MsoNormal style='margin-bottom:12.0pt'>&nbsp;</p>

</div>

</body>

</html>
